{"version":3,"file":"NetworkMonitor.test.js","sourceRoot":"","sources":["NetworkMonitor.test.ts"],"names":[],"mappings":"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","sourcesContent":["import { NetworkMonitor } from '../core/networkMonitor';\nimport { debug } from '../core/debug';\n\n// Mock debug module\njest.mock('../core/debug', () => ({\n  debug: {\n    info: jest.fn(),\n    error: jest.fn()\n  }\n}));\n\n// Mock Response and Headers globally\nglobal.Response = class Response {\n  body: any;\n  status: number;\n  statusText: string;\n  headers: Headers;\n\n  constructor(body: any, init?: ResponseInit) {\n    this.body = body;\n    this.status = init?.status || 200;\n    this.statusText = init?.statusText || 'OK';\n    this.headers = new Headers(init?.headers);\n  }\n\n  async json() {\n    return JSON.parse(this.body);\n  }\n\n  async text() {\n    return this.body;\n  }\n\n  clone() {\n    return new Response(this.body, {\n      status: this.status,\n      statusText: this.statusText,\n      headers: this.headers\n    });\n  }\n};\n\nglobal.Headers = class Headers {\n  private headers: Record<string, string> = {};\n\n  constructor(init?: Record<string, string>) {\n    if (init) {\n      Object.entries(init).forEach(([key, value]) => {\n        this.set(key, value);\n      });\n    }\n  }\n\n  get(name: string) {\n    return this.headers[name.toLowerCase()] || null;\n  }\n\n  set(name: string, value: string) {\n    this.headers[name.toLowerCase()] = value;\n  }\n\n  entries() {\n    return Object.entries(this.headers);\n  }\n};\n\ndescribe('NetworkMonitor', () => {\n  let monitor: NetworkMonitor;\n  let originalFetch: typeof fetch;\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    originalFetch = global.fetch;\n    monitor = new NetworkMonitor();\n  });\n\n  afterEach(() => {\n    global.fetch = originalFetch;\n  });\n\n  describe('fetch monitoring', () => {\n    it('should track successful fetch requests', async () => {\n      const mockResponse = new Response(JSON.stringify({ data: 'test' }), {\n        status: 200,\n        statusText: 'OK',\n        headers: new Headers({ 'Content-Type': 'application/json' })\n      });\n\n      global.fetch = jest.fn().mockResolvedValue(mockResponse);\n\n      const response = await fetch('https://api.example.com/data', {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' }\n      });\n\n      expect(response.status).toBe(200);\n      expect(debug.info).toHaveBeenCalledWith('NETWORK', 'Request completed', expect.any(Object));\n    });\n\n    it('should track failed fetch requests', async () => {\n      const mockResponse = new Response('Not Found', {\n        status: 404,\n        statusText: 'Not Found',\n        headers: new Headers({ 'Content-Type': 'text/plain' })\n      });\n\n      global.fetch = jest.fn().mockRejectedValue(mockResponse);\n\n      try {\n        await fetch('https://api.example.com/invalid');\n      } catch (error) {\n        expect(error).toBeDefined();\n      }\n\n      expect(debug.error).toHaveBeenCalledWith('NETWORK', 'Request failed', expect.any(Object));\n    });\n  });\n\n  describe('request management', () => {\n    it('should store requests up to the maximum limit', () => {\n      const maxRequests = 1000;\n      for (let i = 0; i < maxRequests + 10; i++) {\n        monitor['requests'].push({\n          id: `req-${i}`,\n          url: `https://api.example.com/${i}`,\n          method: 'GET',\n          status: 200,\n          statusText: 'OK',\n          duration: 100,\n          size: 1024,\n          initiator: 'fetch',\n          timestamp: Date.now()\n        });\n      }\n\n      expect(monitor['requests'].length).toBeLessThanOrEqual(maxRequests);\n    });\n\n    it('should clear requests', () => {\n      monitor['requests'].push({\n        id: 'req-1',\n        url: 'https://api.example.com/test',\n        method: 'GET',\n        status: 200,\n        statusText: 'OK',\n        duration: 100,\n        size: 1024,\n        initiator: 'fetch',\n        timestamp: Date.now()\n      });\n\n      monitor.clearRequests();\n      expect(monitor['requests'].length).toBe(0);\n    });\n  });\n\n  describe('request callbacks', () => {\n    it('should notify callbacks when requests are completed', () => {\n      const callback = jest.fn();\n      monitor.onRequest(callback);\n\n      const request = {\n        id: 'req-1',\n        url: 'https://api.example.com/test',\n        method: 'GET',\n        status: 200,\n        statusText: 'OK',\n        duration: 100,\n        size: 1024,\n        initiator: 'fetch',\n        timestamp: Date.now()\n      };\n\n      monitor['requests'].push(request);\n      monitor['notifyRequestCallbacks'](request);\n\n      expect(callback).toHaveBeenCalledWith(request);\n    });\n  });\n\n  describe('header parsing', () => {\n    it('should parse headers from string to object', () => {\n      const headerString = 'content-type: application/json\\nauthorization: Bearer token';\n      const headers = monitor['parseHeaders'](headerString);\n\n      expect(headers).toEqual({\n        'content-type': 'application/json',\n        'authorization': 'Bearer token'\n      });\n    });\n  });\n}); "]}