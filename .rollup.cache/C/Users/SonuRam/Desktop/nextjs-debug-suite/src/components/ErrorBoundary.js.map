{"version":3,"file":"ErrorBoundary.js","sourceRoot":"","sources":["ErrorBoundary.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport styled from '@emotion/styled';\r\nimport { Light as SyntaxHighlighter } from 'react-syntax-highlighter';\r\nimport { tomorrow } from 'react-syntax-highlighter/dist/esm/styles/prism';\r\nimport { ErrorDNAGenerator } from '../core/errorDNA/errorDNA';\r\nimport type { EnhancedErrorDNA } from '../core/types';\r\nimport { useDebugContext } from './DebugSuiteProvider';\r\n\r\nconst ErrorContainer = styled.div`\r\n  padding: 20px;\r\n  margin: 20px;\r\n  border: 1px solid ${({ theme }) => theme.colors.error};\r\n  border-radius: 8px;\r\n  background: ${({ theme }) => theme.colors.background};\r\n`;\r\n\r\nconst ErrorHeader = styled.div`\r\n  margin-bottom: 16px;\r\n`;\r\n\r\nconst ErrorTitle = styled.h2`\r\n  margin: 0 0 8px;\r\n  color: ${({ theme }) => theme.colors.error};\r\n  font-size: 18px;\r\n`;\r\n\r\nconst ErrorMeta = styled.div`\r\n  font-size: 14px;\r\n  color: ${({ theme }) => theme.colors.secondary};\r\n`;\r\n\r\nconst CodeSection = styled.div`\r\n  margin: 16px 0;\r\n`;\r\n\r\nconst SectionTitle = styled.h3`\r\n  margin: 0 0 8px;\r\n  font-size: 16px;\r\n  color: ${({ theme }) => theme.colors.text};\r\n`;\r\n\r\nconst DependencySection = styled.div`\r\n  margin: 16px 0;\r\n`;\r\n\r\nconst DependencyGraph = styled.div`\r\n  padding: 12px;\r\n  background: ${({ theme }) => theme.colors.tabBackground};\r\n  border-radius: 4px;\r\n  font-family: monospace;\r\n  font-size: 12px;\r\n`;\r\n\r\ninterface ErrorBoundaryProps {\r\n  children: React.ReactNode;\r\n  fallback?: React.ReactNode;\r\n}\r\n\r\ninterface ErrorBoundaryState {\r\n  hasError: boolean;\r\n  error?: Error;\r\n  errorInfo?: React.ErrorInfo;\r\n  errorDNA?: EnhancedErrorDNA;\r\n}\r\n\r\nexport class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\r\n  private errorDNAGenerator: ErrorDNAGenerator;\r\n\r\n  constructor(props: ErrorBoundaryProps) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n    this.errorDNAGenerator = new ErrorDNAGenerator();\r\n  }\r\n\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { hasError: true, error };\r\n  }\r\n\r\n  async componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\r\n    try {\r\n      const errorDNA = await this.errorDNAGenerator.generateDNA(error);\r\n      this.setState({ errorDNA, errorInfo });\r\n    } catch (e) {\r\n      console.error('Failed to generate error DNA:', e);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.hasError) {\r\n      return this.props.children;\r\n    }\r\n\r\n    if (this.props.fallback) {\r\n      return this.props.fallback;\r\n    }\r\n\r\n    return <ErrorBoundaryFallback errorState={this.state} />;\r\n  }\r\n}\r\n\r\nconst ErrorBoundaryFallback: React.FC<{ errorState: ErrorBoundaryState }> = ({ errorState }) => {\r\n  const { error, errorDNA } = errorState;\r\n  const { config } = useDebugContext();\r\n\r\n  if (!error) return null;\r\n\r\n  return (\r\n    <ErrorContainer>\r\n      <ErrorHeader>\r\n        <ErrorTitle>{error.name}: {error.message}</ErrorTitle>\r\n        {errorDNA && (\r\n          <ErrorMeta>\r\n            {errorDNA.location.file}:{errorDNA.location.line}\r\n            {errorDNA.location.component && ` in ${errorDNA.location.component}`}\r\n          </ErrorMeta>\r\n        )}\r\n      </ErrorHeader>\r\n\r\n      {errorDNA && (\r\n        <>\r\n          <CodeSection>\r\n            <SectionTitle>Code Preview</SectionTitle>\r\n            <SyntaxHighlighter\r\n              language=\"typescript\"\r\n              style={tomorrow}\r\n              showLineNumbers\r\n              wrapLines\r\n              lineProps={(lineNumber: number) => ({\r\n                style: {\r\n                  backgroundColor: errorDNA.visual.highlightedLines.includes(lineNumber)\r\n                    ? 'rgba(255, 0, 0, 0.1)'\r\n                    : undefined,\r\n                },\r\n              })}\r\n            >\r\n              {errorDNA.visual.codePreview}\r\n            </SyntaxHighlighter>\r\n          </CodeSection>\r\n\r\n          <DependencySection>\r\n            <SectionTitle>Dependencies</SectionTitle>\r\n            <DependencyGraph>\r\n              {Object.entries(errorDNA.visual.dependencies.nodes).map(([id, node]) => (\r\n                <div key={id}>\r\n                  {node.name} ({node.type}):\r\n                  {node.dependencies.length > 0 && (\r\n                    <ul>\r\n                      {node.dependencies.map(dep => (\r\n                        <li key={dep}>{dep}</li>\r\n                      ))}\r\n                    </ul>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </DependencyGraph>\r\n          </DependencySection>\r\n\r\n          {config.ai?.enabled && errorDNA.aiAnalysis && (\r\n            <>\r\n              <SectionTitle>AI Analysis</SectionTitle>\r\n              <div>{errorDNA.aiAnalysis.explanation}</div>\r\n              {errorDNA.aiAnalysis.suggestedFix && (\r\n                <CodeSection>\r\n                  <SectionTitle>Suggested Fix</SectionTitle>\r\n                  <SyntaxHighlighter\r\n                    language=\"typescript\"\r\n                    style={tomorrow}\r\n                  >\r\n                    {errorDNA.aiAnalysis.suggestedFix}\r\n                  </SyntaxHighlighter>\r\n                </CodeSection>\r\n              )}\r\n            </>\r\n          )}\r\n        </>\r\n      )}\r\n    </ErrorContainer>\r\n  );\r\n}; "]}